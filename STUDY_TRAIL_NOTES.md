# 学迹（Study Trail）项目总规

## 基本规则
- 使用 Node.js 实现后端。
- 前端 HTML、CSS、JavaScript 采用模块化拆分。
- 数据统一存储在 MySQL 数据库，Config file: `.env`
- 每次完成修改后必须提交一次代码。
- 每个功能需求都要记录在 Markdown 文档中，并在实现对应功能时更新。
- 所有用户提出的新需求都要在本文件中同步更新。
- 启动 Node.js 服务时使用 Start-Process ... node.exe src/server.js -WindowStyle Hidden 方式后台运行，避免命令行阻塞。
- JavaScript/HTML 文件必须以 UTF-8（无 BOM）保存，使用 VS Code 等工具确认编码；脚本写文件时显式传入 'utf8'，避免中文乱码。

## 功能需求记录

### 功能 1：注册与登录
- 角色：学生、家长。
- 家长使用邮箱注册账号，可管理多个学生子账号。
- 学生账号无需邮箱，通过家长创建。
- 登录统一使用登录名 + 密码。
- 首页先让用户选择身份（学生 / 家长），参考提供的设计图制作登录页。
- 注册入口仅对家长开放；学生身份仅展示登录表单。
- 注册失败时需要给出明确友好的提示信息，避免出现浏览器默认的 “Failed to fetch”。
- 后端需实现注册、登录接口，并与 MySQL 数据库交互。

### 功能 2：家长后台与打卡任务管理
- 家长登录成功后进入管理控制台（顶部 Topbar + 左侧 Sidebar + 右侧内容区）。
- 控制台风格参考提供的设计稿，配色延续登录页的绿色体系。
- Sidebar 首个菜单“打卡配置”对应任务管理，默认显示任务列表，支持新增、编辑、删除。
- 新增、编辑、删除操作完成后自动返回列表并刷新数据。
- 其他菜单暂可占位，后续迭代补充。
- 项目中广泛使用中文文案，开发时务必使用 UTF-8 编码保存文件，避免出现乱码。
- 多任务开发时需确保服务进程真正运行，避免误以为已启动导致流程阻塞。

### 功能 3：学生账号管理
- 左侧菜单新增“学生账号”入口，家长可在控制台中管理子女账号。
- 学生账号信息包括姓名、登录名、密码。
- 支持学生账号的新增、编辑、删除、列表查看。
- 所有操作完成后需自动刷新列表，保持体验一致。

### 功能 4：任务关联管理
- 家长控制台新增“任务关联”导航项，用于维护学生与打卡任务的匹配关系。
- 支持查看学生与任务的对应列表，以及新增、编辑（覆盖重新选择的任务集合）和删除操作。
- 新增关联时先选择学生，再多选一个或多个打卡任务；若学生或任务列表为空，界面会提示先完成基础配置。
- 新建表 `student_tasks`（列：parent_id、student_id、task_id 及时间戳），并对 `student_id + task_id` 建唯一索引。

### 需求 5：学生打卡页面
- 学生登录后跳转至 student.html 页面集中展示当日任务列表，可查看积分、有效期和子任务状态。
- 后端新增 student_task_entries 与 student_task_entry_photos 两张表，记录学生自建子任务、打卡时间以及上传的图片信息。
- 新增 API：GET /api/student/daily-tasks 查询每日任务，POST /api/student/daily-tasks/:taskId/subtasks 创建子任务，PATCH /api/student/subtasks/:entryId/start 记录开始时间，POST /api/student/subtasks/:entryId/complete 完成并上传照片。
- 学生前端支持新增子任务、开始计时、完成提交（含多图上传与完成心得），并展示已完成任务的耗时及照片链接。
