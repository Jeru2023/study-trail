<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>学迹 · 家长控制台</title>
    <link rel="stylesheet" href="/css/admin.css" />
  </head>
  <body>
    <div class="admin-shell">
      <aside class="sidebar" data-open="false">
        <div class="sidebar__brand">
          <span class="sidebar__logo">学迹</span>
          <span class="sidebar__subtitle">Study Trail</span>
        </div>
        <div class="sidebar__profile">
          <span class="avatar" id="sidebarAvatar">P</span>
          <div>
            <strong id="sidebarUserName">家长</strong>
            <span class="role-pill">Parent</span>
          </div>
        </div>
        <nav class="sidebar__nav">
          <button class="nav-item nav-item--active" data-view="analytics" id="navAnalytics">
            <span>数据分析</span>
          </button>
          <button class="nav-item" data-view="tasks" id="navTasks">
            <span>打卡任务</span>
          </button>
          <button class="nav-item" data-view="students" id="navStudents">
            <span>学生账号</span>
          </button>
          <button class="nav-item" data-view="assignments" id="navAssignments">
            <span>任务关联</span>
          </button>
          <button class="nav-item" data-view="plan-approvals" id="navPlanApprovals">
            <span>计划审批</span>
          </button>
          <button class="nav-item" data-view="approvals" id="navApprovals">
            <span>打卡审批</span>
          </button>
          <button class="nav-item" data-view="rewards" id="navRewards">
            <span>积分商城</span>
          </button>
          <button class="nav-item" data-view="redeem" id="navRedeem">
            <span>积分兑换</span>
          </button>
          <button class="nav-item" data-view="points" id="navPoints">
            <span>积分管理</span>
          </button>
          <button class="nav-item" data-view="notifications" id="navNotifications">
            <span>消息中心</span>
          </button>
          <button class="nav-item" disabled>成长档案</button>
        </nav>
        <div class="sidebar__footer">
          <button class="nav-item" id="logoutButton">退出登录</button>
        </div>
      </aside>

      <div class="workspace">
        <header class="topbar">
          <div class="topbar__search">
            <input type="search" placeholder="搜索..." disabled />
          </div>
          <div class="topbar__actions">
            <button type="button" class="icon-button icon-button--badge" id="notificationsButton" aria-label="消息中心">
              <span class="icon icon-envelope" aria-hidden="true"></span>
              <span class="badge" id="notificationsBadge" hidden>0</span>
            </button>
            <div class="user-chip">
              <span class="avatar" id="topbarAvatar">P</span>
              <div class="user-chip__meta">
                <span id="topbarUserName">家长</span>
                <span class="user-chip__role">Parent</span>
              </div>
            </div>
          </div>
        </header>

        <main class="content">
          <section class="view" data-view="analytics">
            <div class="page-header">
              <div>
                <h1>数据分析</h1>
                <p class="page-subtitle">用数据洞察积分趋势与学生表现，助力科学激励。</p>
              </div>
              <div class="page-actions">
                <button type="button" class="ghost-button" id="analyticsRefreshBtn">刷新数据</button>
              </div>
            </div>

            <p class="page-message" id="analyticsMessage"></p>

            <section id="analyticsSummary" class="analytics-summary"></section>

            <section class="analytics-controls">
              <div class="analytics-filters" id="analyticsSourceFilters"></div>
              <div
                class="analytics-ranges"
                id="analyticsRangeTabs"
                role="tablist"
                aria-label="数据分析时间范围"
              >
                <button type="button" class="chip-button" data-range="today" role="tab" aria-selected="false">
                  今日
                </button>
                <button type="button" class="chip-button" data-range="week" role="tab" aria-selected="false">
                  近 7 日
                </button>
                <button type="button" class="chip-button" data-range="month" role="tab" aria-selected="false">
                  近 30 日
                </button>
              </div>
            </section>

            <section class="analytics-grid">
              <article class="analytics-panel">
                <header class="analytics-panel__header">
                  <h2>学生积分排行榜</h2>
                  <span class="analytics-panel__meta" id="analyticsLeaderboardMeta"></span>
                </header>
                <div id="analyticsLeaderboard" class="analytics-leaderboard"></div>
              </article>

              <article class="analytics-panel">
                <header class="analytics-panel__header">
                  <h2>积分趋势</h2>
                  <span class="analytics-panel__meta" id="analyticsTrendMeta"></span>
                </header>
                <div id="analyticsTrendChart" class="analytics-trend"></div>
                <div id="analyticsSourceBreakdown" class="analytics-sources"></div>
              </article>
            </section>

            <section class="analytics-panel analytics-panel--full">
              <header class="analytics-panel__header">
                <h2>学生积分明细</h2>
                <div class="analytics-panel__actions">
                  <select id="analyticsStudentSelect" aria-label="选择学生查看积分明细"></select>
                  <button type="button" class="ghost-button ghost-button--small" id="analyticsStudentRefreshBtn">
                    刷新
                  </button>
                </div>
              </header>
              <div id="analyticsStudentSummary" class="analytics-student-summary"></div>
              <ul id="analyticsStudentHistory" class="analytics-history"></ul>
            </section>
          </section>

          <section class="view" data-view="tasks" hidden>
            <div class="page-header">
              <div>
                <h1>打卡任务</h1>
                <p class="page-subtitle">配置家庭打卡任务，帮助孩子养成好习惯。</p>
              </div>
              <button type="button" class="primary-button" id="addTaskBtn">新建任务</button>
            </div>
            <p class="page-message" id="taskMessage"></p>
          <section id="taskList" class="card"></section>
          <section class="card task-overrides" id="taskOverridesCard">
            <div class="task-overrides__header">
              <div>
                <h2>日程调度</h2>
                <p class="page-subtitle">周一至周五自动使用日常任务，周末使用节假任务，可在此调整特殊放假或调休日期。</p>
              </div>
            </div>
            <p class="form-message" id="taskOverrideMessage"></p>
            <form id="taskOverrideForm" class="task-overrides__form">
              <div class="form-grid task-overrides__fields">
                <label class="form-field">
                  <span class="form-label">开始日期</span>
                  <input type="date" name="startDate" required />
                </label>
                <label class="form-field">
                  <span class="form-label">结束日期</span>
                  <input type="date" name="endDate" required />
                </label>
                <label class="form-field">
                  <span class="form-label">任务类型</span>
                  <div class="task-type-toggle" data-task-type-toggle>
                    <input type="hidden" name="scheduleType" value="weekday" />
                    <button type="button" class="chip-button chip-button--active" data-schedule="weekday">
                      日常任务（周一至周五）
                    </button>
                    <button type="button" class="chip-button" data-schedule="holiday">
                      节假任务（周末及放假日）
                    </button>
                  </div>
                </label>
                <label class="form-field">
                  <span class="form-label">备注（可选）</span>
                  <input type="text" name="note" maxlength="120" placeholder="例如：五一放假" />
                </label>
              </div>
              <div class="task-overrides__actions">
                <button type="submit" class="primary-button">保存调整</button>
              </div>
            </form>
            <div id="taskOverrideList" class="task-overrides__list"></div>
          </section>
        </section>

        <section class="view" data-view="students" hidden>
            <div class="page-header">
              <div>
                <h1>学生账号</h1>
                <p class="page-subtitle">管理孩子的登录信息，方便监督每日学习打卡。</p>
              </div>
              <button type="button" class="primary-button" id="addStudentBtn">添加学生</button>
            </div>
            <p class="page-message" id="studentMessage"></p>
            <section id="studentList" class="card"></section>
          </section>

          <section class="view" data-view="assignments" hidden>
            <div class="page-header">
              <div>
                <h1>任务分配</h1>
                <p class="page-subtitle">为每位孩子安排最合适的学习任务。</p>
              </div>
              <button type="button" class="primary-button" id="addAssignmentBtn">新增分配</button>
            </div>
            <p class="page-message" id="assignmentMessage"></p>
            <section id="assignmentList" class="card"></section>
          </section>

          <section class="view" data-view="plan-approvals" hidden>
            <div class="page-header">
              <div>
                <h1>计划审批</h1>
                <p class="page-subtitle">查看并审批学生提交的每日计划。</p>
              </div>
              <button type="button" class="primary-button" id="planApprovalsRefreshBtn">刷新</button>
            </div>
            <p class="page-message" id="planApprovalsMessage"></p>
            <div class="plan-approval-tabs" id="planApprovalsTabs" role="tablist" aria-label="学习计划审批筛选">
              <button
                type="button"
                class="chip-button chip-button--active"
                data-status="submitted"
                role="tab"
                aria-selected="true"
              >
                待审批
              </button>
              <button
                type="button"
                class="chip-button"
                data-status="approved"
                role="tab"
                aria-selected="false"
              >
                已通过
              </button>
              <button
                type="button"
                class="chip-button"
                data-status="rejected"
                role="tab"
                aria-selected="false"
              >
                已驳回
              </button>
            </div>
            <section id="planApprovalsList" class="plan-approval-list card"></section>
          </section>

          <section class="view" data-view="approvals" hidden>
            <div class="page-header">
              <div>
                <h1>打卡审批</h1>
                <p class="page-subtitle">查看孩子今日的打卡记录 <span id="approvalDateLabel"></span></p>
              </div>
              <button type="button" class="primary-button" id="refreshApprovalsBtn">刷新</button>
            </div>
            <p class="page-message" id="approvalMessage"></p>
            <div class="approval-tabs" id="approvalTabs" role="tablist" aria-label="打卡审批任务筛选">
              <button
                type="button"
                class="chip-button chip-button--active"
                data-tab="pending"
                role="tab"
                aria-selected="true"
              >
                待审批
              </button>
              <button
                type="button"
                class="chip-button"
                data-tab="unsubmitted"
                role="tab"
                aria-selected="false"
              >
                未提交
              </button>
              <button
                type="button"
                class="chip-button"
                data-tab="completed"
                role="tab"
                aria-selected="false"
              >
                已完成
              </button>
            </div>
            <section id="approvalList" class="card approval-list"></section>
          </section>
          <section class="view" data-view="rewards" hidden>
            <div class="page-header">
              <div>
                <h1>积分商城</h1>
                <p class="page-subtitle">设置孩子可以使用积分兑换的奖励。</p>
              </div>
              <button type="button" class="primary-button" id="addRewardBtn">新增奖励</button>
            </div>
            <p class="page-message" id="rewardMessage"></p>
            <section id="rewardList" class="reward-list"></section>
          </section>

          <section class="view" data-view="redeem" hidden>
            <div class="page-header">
              <div>
                <h1>积分兑换</h1>
                <p class="page-subtitle">为孩子扣除积分，完成奖励兑换并同步库存。</p>
              </div>
              <button type="button" class="ghost-button" id="redeemRefreshBtn">刷新</button>
            </div>
            <p class="page-message" id="redeemMessage"></p>
            <div class="points-layout">
              <aside class="points-students card" id="redeemStudentList"></aside>
              <section class="points-detail card" id="redeemDetail" data-empty="true">
                <div class="points-detail__placeholder" id="redeemEmptyHint">
                  <p>请选择一位学生进行兑换。</p>
                </div>
                <div class="points-detail__content" id="redeemDetailContent" hidden>
                  <header class="points-detail__header">
                    <div>
                      <h2 id="redeemStudentName">学生姓名</h2>
                      <p class="points-detail__meta">
                        <span id="redeemStudentLogin"></span>
                        <span id="redeemStudentUpdated"></span>
                      </p>
                    </div>
                    <div class="points-detail__balance">
                      <span class="points-detail__balance-label">当前积分</span>
                      <span class="points-detail__balance-value" id="redeemStudentBalance">0</span>
                    </div>
                  </header>

                  <section class="points-actions-group">
                    <form id="redeemForm" class="points-form">
                      <h3>兑换奖励</h3>
                      <div class="form-grid">
                        <label class="form-field">
                          <span class="form-label">选择奖励</span>
                          <select name="rewardId" required>
                            <option value="">请选择奖励</option>
                          </select>
                        </label>
                        <label class="form-field">
                          <span class="form-label">兑换数量</span>
                          <input type="number" name="quantity" min="1" step="1" value="1" />
                        </label>
                      </div>
                      <label class="form-field">
                        <span class="form-label">备注说明</span>
                        <input
                          type="text"
                          name="note"
                          maxlength="120"
                          placeholder="记录兑换场景（选填）"
                        />
                      </label>
                      <p class="form-message" id="redeemFormMessage"></p>
                      <div class="form-actions">
                        <button type="submit" class="primary-button">确认兑换</button>
                      </div>
                    </form>
                  </section>

                  <section class="points-history">
                    <header class="points-history__header">
                      <h3>积分记录</h3>
                      <button
                        type="button"
                        class="ghost-button ghost-button--small"
                        id="redeemHistoryRefreshBtn"
                      >
                        刷新记录
                      </button>
                    </header>
                    <ul class="points-history__list" id="redeemHistoryList"></ul>
                  </section>
                </div>
              </section>
            </div>
          </section>

          <section class="view" data-view="points" hidden>
            <div class="page-header">
              <div>
                <h1>积分管理</h1>
                <p class="page-subtitle">针对孩子进行积分加减，掌握积分账户动态。</p>
              </div>
              <button type="button" class="ghost-button" id="pointsRefreshBtn">刷新</button>
            </div>
            <p class="page-message" id="pointsMessage"></p>
            <div class="points-layout">
              <aside class="points-students card" id="pointsStudentList"></aside>
            <section class="points-detail card" id="pointsDetail" data-empty="true">
                <div class="points-detail__placeholder" id="pointsEmptyHint">
                  <p>请选择一位学生查看积分详情。</p>
                </div>
                <div class="points-detail__content" id="pointsDetailContent" hidden>
                  <header class="points-detail__header">
                    <div>
                      <h2 id="pointsStudentName">学生姓名</h2>
                      <p class="points-detail__meta">
                        <span id="pointsStudentLogin"></span>
                        <span id="pointsStudentUpdated"></span>
                      </p>
                    </div>
                    <div class="points-detail__balance">
                      <span class="points-detail__balance-label">当前积分</span>
                      <span class="points-detail__balance-value" id="pointsStudentBalance">0</span>
                    </div>
                  </header>

                  <section class="points-actions-group">
                    <form id="pointsAdjustForm" class="points-form">
                      <h3>积分加减</h3>
                      <div class="form-grid">
                        <label class="form-field">
                          <span class="form-label">调整积分</span>
                          <input
                            type="number"
                            name="delta"
                            required
                            step="1"
                            placeholder="输入正数或负数"
                          />
                        </label>
                        <label class="form-field">
                          <span class="form-label">备注说明</span>
                          <input
                            type="text"
                            name="note"
                            maxlength="120"
                            placeholder="记录调整原因（选填）"
                          />
                        </label>
                      </div>
                      <p class="form-message" id="pointsAdjustMessage"></p>
                      <div class="form-actions">
                        <button type="submit" class="primary-button">确认调整</button>
                      </div>
                    </form>
                  </section>

                  <section class="points-history">
                    <header class="points-history__header">
                      <h3>积分记录</h3>
                      <button
                        type="button"
                        class="ghost-button ghost-button--small"
                        id="pointsHistoryRefreshBtn"
                      >
                        刷新记录
                      </button>
                    </header>
                    <ul class="points-history__list" id="pointsHistoryList"></ul>
                  </section>
                </div>
              </section>
            </div>
          </section>

          <section class="view" data-view="notifications" hidden>
            <div class="page-header">
              <div>
                <h1>消息中心</h1>
                <p class="page-subtitle">查看与打卡相关的提醒和最新动态。</p>
              </div>
              <button type="button" class="ghost-button" id="notificationsMarkAll">全部设为已读</button>
            </div>
            <p class="page-message" id="notificationsMessage"></p>
            <ul class="notification-list" id="notificationList"></ul>
          </section>
        </main>
      </div>
    </div>

    <div class="modal" id="taskModal" hidden>
      <div class="modal__backdrop" data-action="close-modal"></div>
      <div class="modal__dialog">
        <header class="modal__header">
          <h2 id="taskModalTitle">新建任务</h2>
          <button type="button" class="icon-button" id="closeTaskModal" aria-label="关闭">×</button>
        </header>
        <form id="taskForm" class="modal__form">
          <label class="form-field">
            <span class="form-label">任务标题</span>
            <input type="text" name="title" required maxlength="150" placeholder="例如：语文朗读 15 分钟" />
          </label>

          <label class="form-field">
            <span class="form-label">任务说明</span>
            <textarea name="description" rows="4" placeholder="补充任务要求或奖励机制"></textarea>
          </label>

          <label class="form-field">
            <span class="form-label">任务类型</span>
            <div class="task-type-toggle" data-task-type-toggle>
              <input type="hidden" name="scheduleType" value="weekday" />
              <button type="button" class="chip-button chip-button--active" data-schedule="weekday">
                日常任务（周一至周五）
              </button>
              <button type="button" class="chip-button" data-schedule="holiday">
                节假任务（周末及放假日）
              </button>
            </div>
          </label>

          <label class="form-field">
            <span class="form-label">任务积分</span>
            <input type="number" name="points" min="0" step="1" required placeholder="例如：10" />
          </label>

          <div class="form-grid">
            <label class="form-field">
              <span class="form-label">开始日期</span>
              <input type="date" name="startDate" />
            </label>
            <label class="form-field">
              <span class="form-label">结束日期</span>
              <input type="date" name="endDate" />
            </label>
          </div>

          <p class="form-message" id="taskFormMessage"></p>

          <div class="modal__actions">
            <button type="button" class="ghost-button" id="cancelTaskBtn">取消</button>
            <button type="submit" class="primary-button">保存</button>
          </div>
        </form>
      </div>
    </div>

    <div class="modal" id="studentModal" hidden>
      <div class="modal__backdrop" data-action="close-modal"></div>
      <div class="modal__dialog">
        <header class="modal__header">
          <h2 id="studentModalTitle">添加学生</h2>
          <button type="button" class="icon-button" id="closeStudentModal" aria-label="关闭">×</button>
        </header>
        <form id="studentForm" class="modal__form">
          <label class="form-field">
            <span class="form-label">学生姓名</span>
            <input type="text" name="name" required maxlength="80" placeholder="例如：小明" />
          </label>
          <label class="form-field">
            <span class="form-label">登录名</span>
            <input type="text" name="loginName" required maxlength="64" placeholder="例如：xiaoming01" />
          </label>
          <label class="form-field">
            <span class="form-label">登录密码</span>
            <input type="password" name="password" minlength="6" placeholder="新密码（编辑时可留空）" />
          </label>

          <p class="form-message" id="studentFormMessage"></p>

          <div class="modal__actions">
            <button type="button" class="ghost-button" id="cancelStudentBtn">取消</button>
            <button type="submit" class="primary-button">保存</button>
          </div>
        </form>
      </div>
    </div>

    <div class="modal" id="assignmentModal" hidden>
      <div class="modal__backdrop" data-action="close-modal"></div>
      <div class="modal__dialog">
        <header class="modal__header">
          <h2 id="assignmentModalTitle">添加关联</h2>
          <button type="button" class="icon-button" id="closeAssignmentModal" aria-label="关闭">×</button>
        </header>
        <form id="assignmentForm" class="modal__form">
          <label class="form-field">
            <span class="form-label">选择学生</span>
            <select name="studentId" required></select>
          </label>

          <div class="form-field">
            <span class="form-label">选择打卡任务</span>
            <div class="form-hint">可多选，至少选择一项以建立关联。</div>
            <div data-assignment-tasks class="assignment-task-options"></div>
          </div>

          <p class="form-message" id="assignmentFormMessage"></p>

          <div class="modal__actions">
            <button type="button" class="ghost-button" id="cancelAssignmentBtn">取消</button>
            <button type="submit" class="primary-button">保存</button>
          </div>
        </form>
      </div>
    </div>

    <div class="modal" id="rewardModal" hidden>
      <div class="modal__backdrop" data-action="close-modal"></div>
      <div class="modal__dialog">
        <header class="modal__header">
          <h2 id="rewardModalTitle">新增奖励</h2>
          <button type="button" class="icon-button" id="closeRewardModal" aria-label="关闭">×</button>
        </header>
        <form id="rewardForm" class="modal__form">
          <label class="form-field">
            <span class="form-label">奖励名称</span>
            <input type="text" name="title" required maxlength="150" placeholder="例如：周末看电影" />
          </label>

          <div class="form-grid">
            <label class="form-field">
              <span class="form-label">所需积分</span>
              <input type="number" name="pointsCost" min="0" step="1" required placeholder="例如：100" />
            </label>
            <label class="form-field">
              <span class="form-label">库存数量</span>
              <input
                type="number"
                name="stock"
                min="0"
                step="1"
                placeholder="留空表示不限量"
              />
            </label>
          </div>

          <label class="form-field">
            <span class="form-label">奖励说明</span>
            <textarea name="description" rows="3" placeholder="补充奖励细节或兑换说明"></textarea>
          </label>

          <label class="form-field form-field--inline">
            <span class="form-label">状态</span>
            <label class="checkbox">
              <input type="checkbox" name="isActive" checked />
              <span>上架可兑换</span>
            </label>
          </label>

          <p class="form-message" id="rewardFormMessage"></p>

          <div class="modal__actions">
            <button type="button" class="ghost-button" id="cancelRewardBtn">取消</button>
            <button type="submit" class="primary-button">保存</button>
          </div>
        </form>
      </div>
    </div>

    <script type="module" src="/js/admin/main.js"></script>
  </body>
</html>
