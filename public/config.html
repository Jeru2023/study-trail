<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>学迹 · 配置中心</title>
    <link rel="stylesheet" href="/css/admin.css" />
  </head>
  <body>
    <div class="admin-shell">
      <aside class="sidebar" data-component="parent-sidebar" data-open="false" data-active="config:students"></aside>

      <div class="workspace">

        <main class="content">
          <section class="view" data-view="students">
            <div class="page-header">
              <div>
                <h1>学生账号</h1>
                <p class="page-subtitle">管理和维护绑定的学生登录信息。</p>
              </div>
              <div class="page-actions">
                <button type="button" class="primary-button" id="addStudentBtn">添加学生</button>
              </div>
            </div>
            <p class="page-message" id="studentMessage"></p>
            <section class="card">
              <header class="card__header">
                <h2>账号列表</h2>
              </header>
              <div class="table-container" id="studentList"></div>
            </section>
          </section>

          <section class="view" data-view="tasks" hidden>
            <div class="page-header">
              <div>
                <h1>打卡任务</h1>
                <p class="page-subtitle">配置每日打卡任务，统一管理默认展示策略。</p>
              </div>
              <div class="page-actions">
                <button type="button" class="primary-button" id="addTaskBtn">新建任务</button>
              </div>
            </div>
            <p class="page-message" id="taskMessage"></p>
            <section class="card">
              <header class="card__header">
                <h2>任务列表</h2>
              </header>
              <div class="table-container" id="taskList"></div>
            </section>
            <p class="page-hint">
              需要为特殊日期调整任务展示？<a class="inline-link" href="/config-schedules.html">打开日期调度</a>
              即可统一管理。
            </p>
          </section>

          <section class="view" data-view="plan-reward" hidden>
            <div class="page-header">
              <div>
                <h1>计划奖励</h1>
                <p class="page-subtitle">配置每日计划审批通过时的默认奖励积分。</p>
              </div>
            </div>
            <p class="page-message" id="planRewardMessage"></p>
            <section class="card">
              <header class="card__header">
                <h2>默认奖励分值</h2>
              </header>
              <form id="planRewardForm" class="plan-reward-form">
                <label class="form-field">
                  <span class="form-label">默认奖励积分</span>
                  <input
                    type="number"
                    name="planRewardPoints"
                    id="planRewardInput"
                    min="0"
                    step="1"
                    required
                    placeholder="例如：5"
                  />
                  <p class="form-hint">学生的每日计划通过审批后，将默认发放该积分，可在审批时微调。</p>
                </label>
                <p class="form-message" id="planRewardFormMessage"></p>
                <div class="form-actions plan-reward-form__actions">
                  <button type="submit" class="primary-button">保存</button>
                </div>
              </form>
            </section>
          </section>

          <section class="view" data-view="assignments" hidden>
            <div class="page-header">
              <div>
                <h1>任务关联</h1>
                <p class="page-subtitle">为学生分配打卡任务并保持同步更新。</p>
              </div>
              <div class="page-actions">
                <button type="button" class="primary-button" id="addAssignmentBtn">添加关联</button>
              </div>
            </div>
            <p class="page-message" id="assignmentMessage"></p>
            <section class="card">
              <header class="card__header">
                <h2>关联列表</h2>
              </header>
              <div class="table-container" id="assignmentList"></div>
            </section>
          </section>

          <section class="view" data-view="rewards" hidden>
            <div class="page-header">
              <div>
                <h1>积分商城</h1>
                <p class="page-subtitle">维护兑换奖励，管理库存与上下架状态。</p>
              </div>
              <div class="page-actions">
                <button type="button" class="primary-button" id="addRewardBtn">新增奖励</button>
              </div>
            </div>
            <p class="page-message" id="rewardMessage"></p>
            <section class="card">
              <header class="card__header">
                <h2>奖励列表</h2>
              </header>
              <div class="table-container" id="rewardList"></div>
            </section>
          </section>

          <section class="view" data-view="point-presets" hidden>
            <div class="page-header">
              <div>
                <h1>奖惩模版</h1>
                <p class="page-subtitle">维护常用奖惩模版，让积分调整更高效。</p>
              </div>
              <div class="page-actions">
                <button type="button" class="primary-button" id="addPointPresetBtn">新增模版</button>
              </div>
            </div>
            <p class="page-message" id="pointPresetMessage"></p>
            <section class="card">
              <header class="card__header card__header--split">
                <h2>模版列表</h2>
                <div class="preset-tab-group" data-preset-tabs role="tablist" aria-label="奖惩模版分类">
                  <button
                    type="button"
                    class="chip-button chip-button--active"
                    data-preset-tab="bonus"
                    role="tab"
                    aria-selected="true"
                  >
                    加分项
                  </button>
                  <button
                    type="button"
                    class="chip-button"
                    data-preset-tab="penalty"
                    role="tab"
                    aria-selected="false"
                  >
                    减分项
                  </button>
                </div>
              </header>
              <div class="table-container" id="pointPresetList"></div>
            </section>
          </section>
        </main>
      </div>
    </div>

    <div class="modal" id="taskModal" hidden>
      <div class="modal__backdrop" data-action="close-modal"></div>
      <div class="modal__dialog">
        <header class="modal__header">
          <h2 id="taskModalTitle">新建任务</h2>
          <button type="button" class="icon-button" id="closeTaskModal" aria-label="关闭">×</button>
        </header>
        <form id="taskForm" class="modal__form">
          <label class="form-field">
            <span class="form-label">任务标题</span>
            <input type="text" name="title" required maxlength="150" placeholder="例如：语文朗读 15 分钟" />
          </label>

          <label class="form-field">
            <span class="form-label">
              任务类型
            </span>
            <div class="task-type-toggle" data-task-type-toggle>
              <input type="hidden" name="scheduleType" value="weekday" />
              <button type="button" class="chip-button chip-button--active" data-schedule="weekday" data-tooltip="工作日每天出现">
                日常任务
              </button>
              <button type="button" class="chip-button" data-schedule="holiday" data-tooltip="节假日和周末出现">
                节假任务
              </button>
              <button type="button" class="chip-button" data-schedule="recurring" data-tooltip="每周固定一天出现">
                定期任务
              </button>
            </div>
          </label>
          <label class="form-field" data-recurring-fields hidden>
            <span class="form-label">选择每周的执行日</span>
            <div class="task-weekday-toggle" data-weekday-toggle>
              <input type="hidden" name="recurringDayOfWeek" value="" />
              <button type="button" class="chip-button" data-weekday="1">周一</button>
              <button type="button" class="chip-button" data-weekday="2">周二</button>
              <button type="button" class="chip-button" data-weekday="3">周三</button>
              <button type="button" class="chip-button" data-weekday="4">周四</button>
              <button type="button" class="chip-button" data-weekday="5">周五</button>
              <button type="button" class="chip-button" data-weekday="6">周六</button>
              <button type="button" class="chip-button" data-weekday="0">周日</button>
            </div>
            <p class="form-hint">仅限定期任务设置，每周会在所选日期显示给学生。</p>
          </label>

          <label class="form-field">
            <span class="form-label">任务积分</span>
            <input type="number" name="points" min="0" step="1" required placeholder="例如：10" />
          </label>

          <p class="form-message" id="taskFormMessage"></p>

          <input type="hidden" name="startDate" value="" />
          <input type="hidden" name="endDate" value="" />

          <div class="modal__actions">
            <button type="button" class="ghost-button" id="cancelTaskBtn">取消</button>
            <button type="submit" class="primary-button">保存</button>
          </div>
        </form>
      </div>
    </div>

    <div class="modal" id="studentModal" hidden>
      <div class="modal__backdrop" data-action="close-modal"></div>
      <div class="modal__dialog">
        <header class="modal__header">
          <h2 id="studentModalTitle">添加学生</h2>
          <button type="button" class="icon-button" id="closeStudentModal" aria-label="关闭">×</button>
        </header>
        <form id="studentForm" class="modal__form">
          <label class="form-field">
            <span class="form-label">学生姓名</span>
            <input type="text" name="name" required maxlength="80" placeholder="例如：小明" />
          </label>
          <label class="form-field">
            <span class="form-label">登录名</span>
            <input type="text" name="loginName" required maxlength="64" placeholder="例如：xiaoming01" />
          </label>
          <label class="form-field">
            <span class="form-label">登录密码</span>
            <input type="password" name="password" minlength="6" placeholder="新密码（编辑时可留空）" />
          </label>

          <p class="form-message" id="studentFormMessage"></p>

          <div class="modal__actions">
            <button type="button" class="ghost-button" id="cancelStudentBtn">取消</button>
            <button type="submit" class="primary-button">保存</button>
          </div>
        </form>
      </div>
    </div>

    <div class="modal" id="assignmentModal" hidden>
      <div class="modal__backdrop" data-action="close-modal"></div>
      <div class="modal__dialog">
        <header class="modal__header">
          <h2 id="assignmentModalTitle">添加关联</h2>
          <button type="button" class="icon-button" id="closeAssignmentModal" aria-label="关闭">×</button>
        </header>
        <form id="assignmentForm" class="modal__form">
          <label class="form-field">
            <span class="form-label">选择学生</span>
            <select name="studentId" required></select>
          </label>

          <div class="form-field">
            <span class="form-label">选择打卡任务</span>
            <div class="form-hint">可多选，至少选择一项以建立关联。</div>
            <div data-assignment-tasks class="assignment-task-options"></div>
          </div>

          <p class="form-message" id="assignmentFormMessage"></p>

          <div class="modal__actions">
            <button type="button" class="ghost-button" id="cancelAssignmentBtn">取消</button>
            <button type="submit" class="primary-button">保存</button>
          </div>
        </form>
      </div>
    </div>

    <div class="modal" id="rewardModal" hidden>
      <div class="modal__backdrop" data-action="close-modal"></div>
      <div class="modal__dialog">
        <header class="modal__header">
          <h2 id="rewardModalTitle">新增奖励</h2>
          <button type="button" class="icon-button" id="closeRewardModal" aria-label="关闭">×</button>
        </header>
        <form id="rewardForm" class="modal__form">
          <label class="form-field">
            <span class="form-label">奖励名称</span>
            <input type="text" name="title" required maxlength="150" placeholder="例如：周末看电影" />
          </label>

          <div class="form-grid">
            <label class="form-field">
              <span class="form-label">所需积分</span>
              <input type="number" name="pointsCost" min="0" step="1" required placeholder="例如：100" />
            </label>
            <label class="form-field">
              <span class="form-label">库存数量</span>
              <input
                type="number"
                name="stock"
                min="0"
                step="1"
                placeholder="留空表示不限量"
              />
            </label>
          </div>

          <label class="form-field">
            <span class="form-label">奖励说明</span>
            <textarea name="description" rows="3" placeholder="补充奖励细节或兑换说明"></textarea>
          </label>

          <label class="form-field form-field--inline">
            <span class="form-label">状态</span>
            <label class="checkbox">
              <input type="checkbox" name="isActive" checked />
              <span>上架可兑换</span>
            </label>
          </label>

          <p class="form-message" id="rewardFormMessage"></p>

          <div class="modal__actions">
            <button type="button" class="ghost-button" id="cancelRewardBtn">取消</button>
            <button type="submit" class="primary-button">保存</button>
          </div>
        </form>
      </div>
    </div>

    <div class="modal" id="pointPresetModal" hidden>
      <div class="modal__backdrop" data-action="close-modal"></div>
      <div class="modal__dialog">
        <header class="modal__header">
          <h2 id="pointPresetModalTitle">新增模版</h2>
          <button type="button" class="icon-button" id="closePointPresetModal" aria-label="关闭">×</button>
        </header>
        <form id="pointPresetForm" class="modal__form">
          <label class="form-field">
            <span class="form-label">项目名称</span>
            <input type="text" name="name" required maxlength="120" placeholder="例如：按时完成作业" />
          </label>
          <label class="form-field">
            <span class="form-label">分值</span>
            <input type="number" name="points" min="0" step="1" required placeholder="例如：5" />
          </label>
          <fieldset class="form-field">
            <legend class="form-label">类型</legend>
            <div class="radio-group">
              <label class="radio">
                <input type="radio" name="direction" value="bonus" checked />
                <span>加分</span>
              </label>
              <label class="radio">
                <input type="radio" name="direction" value="penalty" />
                <span>扣分</span>
              </label>
            </div>
          </fieldset>
          <p class="form-message" id="pointPresetFormMessage"></p>
          <div class="modal__actions">
            <button type="button" class="ghost-button" id="cancelPointPresetBtn">取消</button>
            <button type="submit" class="primary-button">保存</button>
          </div>
        </form>
      </div>
    </div>

    <script type="module" src="/js/admin/config.js"></script>
  </body>
</html>
